{% extends 'base.html' %} 
{% load static %} 
{% load user_tags %}
{% is_admin request.user as user_is_admin %}


{% block title %} Blog List - AlienBlog {% endblock %}
{% block link %}
  <script src="{% static 'js/blog.js' %}"></script>
  <script src="{% static 'js/common.js' %}"></script>
  <script src="{% static 'js/popUp.js' %}"></script>
{% endblock %} 
{% block content %}
<div
  class="min-h-[calc(100vh-theme(spacing.header))] pb-[100px] bg-my-black-300"
>
  <div class="w-full mx-auto flex flex-col items-center gap-y-10">
    <!-- Featured Blog -->
    <div class="w-full flex justify-center max-w-7xl">
      <div
        class="relative grid w-full min-h-[500px] max-h-[600px] grid-cols-1 grid-rows-1"
      >
        <a
          href="/blogs/{{ featuredBlog.id }}"
          class="col-start-1 row-start-1 h-full w-full z-10"
        ></a>

        {% if user_is_admin %}
          <div class="z-[15] absolute top-8 right-4 px-4 py-5 rounded-3xl bg-zinc-800 flex gap-x-6">
            <a href="/blogs/edit/{{ featuredBlog.id }}" class="flex items-center justify-center text-white">
              <i class="fa-solid fa-pen-to-square fa-lg"></i>
            </a>
            <button 
              data-blog-id="{{ featuredBlog.id }}"
              data-blog-title="{{ featuredBlog.title }}"
              data-toggle="deleteBlogPopUp" class="flex items-center justify-center text-red-400">
              <i class="fa-solid fa-trash-can fa-lg"></i>
            </button>
          </div>
        {% endif %}

        <!-- Big boi picture -->
        <div class="col-start-1 row-start-1 grid">
          <img
            src="{% static 'imgs/cat.jpg' %}"
            class="col-start-1 row-start-1 w-full min-h-[500px] max-h-[600px] object-cover rounded-b-md"
          />
          <div class="col-start-1 row-start-1 w-full h-full bg-black/30"></div>
        </div>

        <div
          class="col-start-1 row-start-1 w-full h-full flex items-end px-5 py-10"
        >
          <div class="flex justify-between items-center w-full">
            <div class="max-w-sm">
              <div class="w-min">
                <p class="px-4 py-2 rounded-3xl bg-zinc-700/60 text-white">
                  {{ featuredBlog.tag|capfirst }}
                </p>
              </div>

              <h2 class="mt-3 text-4xl text-white line-clamp-2">
                {{ featuredBlog.title|capfirst }}
              </h2>
              <p class="text-gray-300 mt-3 line-clamp-2">
                {{ featuredBlog.description }}
              </p>
            </div>

            <!-- Author -->
            <a href="#" class="z-20">
              <div class="flex flex-col gap-y-2 justify-end">
                <div class="flex gap-x-3 items-center">
                  <img
                    src="{% static 'imgs/placeholder.jpg' %}"
                    class="w-[40px] h-[40px] rounded-full object-cover"
                  />
                  <p class="text-white text-lg">
                    {{ featuredBlog.author.first_name }} {{ featuredBlog.author.last_name }}
                  </p>
                </div>
                <p class="ml-auto text-gray-300 flex gap-x-3 items-center">
                  <span>{{ featuredBlog.date_created|date:"F j, Y" }}</span>
                  <span>10 mins read</span>
                </p>
              </div>
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Blog List -->
    <div class="max-w-7xl px-5 w-full">
      <!-- Blog header -->
      <div>
        <h2 class="text-4xl text-white">Blog</h2>
        <p class="text-gray-400 mt-3">
          Lorem ipsum dolor, sit amet consectetur adipisicing elit. Accusantium
          ullam sint debitis sequi.
        </p>
      </div>

      <!-- Blog controls -->
      <div
        class="mt-6 w-full flex justify-center md:justify-between items-center text-white gap-y-5 gap-x-5"
      >
        <div class="relative">
          <button
            data-toggle="dropdown"
            id="filter-button"
            class="md:hidden rounded-md flex bg-mono-neon-purple px-5 py-2 gap-3"
          >
            <div class="text-center">Filter Posts</div>
            <div class="flex items-center justify-center pb-1">
              <i class="fa-solid fa-caret-down fa-lg"></i>
            </div>
          </button>

          <!-- Mobile -->
          <div
            data-dropdown
            class="shadow-lg md:hidden mt-2 py-2 hidden rounded-md absolute top-full left-0 z-10 w-full bg-zinc-800"
          >
            <div
              id="filter-controls-container-mobile"
              class="flex flex-col"
            >
              <button class="pl-5 py-2 hover:bg-white/10 flex" value='all'>
                <span>All</span>
              </button>
              {% for tag in blogTags %}
              <button class="pl-5 py-2 hover:bg-white/10 flex" value="{{ tag }}">
                <span>{{ tag|capfirst }}</span>
              </button>
              {% endfor %}
            </div>
          </div>

          <!-- PC -->
          <div
            id="filter-controls-container-desktop"
            class="hidden md:flex justify-center gap-x-5"
          >
            <button
              class="py-2 px-5 bg-white text-black rounded-md"
              value="all"
            >
              All
            </button>

            {% for tag in blogTags %}
            <button
              class="py-2 px-5 hover:bg-white/10 rounded-md"
              value="{{ tag }}"
            >
              {{ tag|capfirst }}
            </button>
            {% endfor %}
          </div>
        </div>

        <div class="relative gap-x-5 flex items-center">
          <button
            data-toggle="dropdown"
            class="w-[160px] py-2 px-5 border border-gray-500 rounded-md flex gap-x-2"
          >
            <span class="text-gray-400">Sort by:</span>
            <span id="sort-by-active">Newest</span>
          </button>

          <div
            data-dropdown
            id="sort-by-dropdown"
            class="shadow-lg hidden py-2 mt-2 rounded-md w-full absolute top-full bg-zinc-800 z-10"
          >
            <ul class="flex flex-col">
              <li>
                <button
                  class="w-full py-2 pl-5 hover:bg-white/10 flex"
                  value="Newest"
                >
                  <span>Newest</span>
                </button>
              </li>
              <li>
                <button
                  class="w-full py-2 pl-5 hover:bg-white/10 flex"
                  value="Oldest"
                >
                  <span>Oldest</span>
                </button>
              </li>
              <li>
                <button
                  class="w-full py-2 pl-5 hover:bg-white/10 flex"
                  value="Popular"
                >
                  <span>Popular</span>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Blog Grid -->
      <div
        id="blogs-container"
        class="mt-8 grid sm:grid-cols-2 md:grid-cols-3 w-full gap-x-5 gap-y-8"
      >
        {% for blog in blogs %}

        <article>
          <div
            class="relative group group-focus-within:ring-2 ring-white ring-offset-1 ring-offset-black rounded-md flex flex-col pb-5"
          >
            <a class="absolute inset-0" href="/blogs/{{ blog.id }}"></a>
              <span class="sr-only">Read more about {{ blog.title }}</span>
              <div>
                <img
                  src="{% static 'imgs/placeholder.jpg' %}"
                  class="object-cover min-h-[300px] max-h-[300px] w-full rounded-md"
                />
              </div>

              <!-- Tag -->
              <p
                class="absolute top-2 left-2 px-4 py-2 rounded-3xl bg-zinc-700/60 text-white"
              >{{ blog.tag|capfirst }}
              </p>

              <!-- Admin controls? --> 
              {% if user_is_admin %}
                <div class="absolute top-2 right-2 px-4 py-5 rounded-3xl bg-zinc-800 flex gap-x-6">
                  <a href="/blogs/edit/{{ blog.id }}" class="flex items-center justify-center text-white">
                    <i class="fa-solid fa-pen-to-square fa-lg"></i>
                  </a>
                  <button 
                    data-blog-id="{{ blog.id }}"
                    data-blog-title="{{ blog.title }}"
                    data-toggle="deleteBlogPopUp" class="flex items-center justify-center text-red-400">
                    <i class="fa-solid fa-trash-can fa-lg"></i>
                  </button>
                </div>
              {% endif %}

              <div class="flex flex-col gap-y-3">
                <!-- Date of creation -->
                <p class="mt-2 text-gray-400 flex gap-x-3 items-center">
                  <span>{{ blog.date_created|date:"F j, Y" }}</span>
                  <span class="ml-auto">10 mins read</span>
                </p>

                <!-- Blog content -->
                <div class="flex flex-col gap-y-2">
                  <h3 class="text-2xl text-white line-clamp-2">
                    {{ blog.title }}
                  </h3>

                  <!-- Blog description -->
                  <p class="text-gray-400 line-clamp-2">
                    {{ blog.description }}
                  </p>
                </div>

                <!-- Author -->
                <a href="/user" class="z-10">
                  <div class="flex gap-x-3 items-center">
                    <img
                      src="{% static 'imgs/cat.jpg' %}"
                      class="w-[40px] h-[40px] object-cover rounded-full"
                    />
                    <p class="text-white">
                      {{ blog.author.first_name }} {{ blog.author.last_name }}
                    </p>
                  </div>
                </a>
              </div>
          </div>
        </article>
        {% endfor %}
      </div>
    </div>
  </div>

  {% if user_is_admin %}
  <div id="delete-blog-pop-up" class="ancestor-to-hide hidden fixed inset-0 z-[1000] bg-black/50 flex items-center justify-center">
    <div class="w-full max-w-[500px] bg-zinc-800 text-white shadow-lg rounded-md text-center">
      
      <div class="flex flex-col items-center gap-y-6 px-8 pt-6 relative">

          <span class="js-hide-ancestor absolute top-9 right-8 flex items-center justify-center text-xl hover:cursor-pointer">
            <i class="fa-solid fa-xmark fa-xl"></i>
          </span>

        <div class="py-8 px-5 bg-red-300/10 rounded-full relative">
          <span class="flex items-center justify-center text-red-400 text-lg">
            <i class="fa-solid fa-circle-exclamation fa-xl"></i>
          </span>
        </div>
        <div class="flex flex-col gap-y-3">
          <h2 class="text-2xl">You are about to delete a blog</h2>
          <p>Are you sure you want to delete <span id="delete-blog-pop-up-blog-name" class="font-semibold"></span>. This action cannot be undone.</p>
        </div>
      </div>

      <form 
        method="post"
        action="/blogs/delete/"
        class="mt-12 bg-zinc-900 flex gap-5 px-8 py-6">
        {% csrf_token %}
        <button class="js-hide-ancestor py-2 px-5 border border-white w-full rounded-md">Cancel</button>
        <button class="py-2 px-5 w-full rounded-md bg-red-700">Delete</button>
      </form>
    </div>
  </div>
  {% endif %}

  {{ blogs_as_data|json_script:'blogs_data' }} 
  {{ featuredBlog.id|json_script:'featuredBlogId' }}
  {% endblock %}
</div>
